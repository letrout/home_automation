Generate a config file
	$ docker run --rm telegraf telegraf config > /docker/telegraf/telegraf.conf

Run influxdb2
	$ docker network create influxdb
	<start influxdb2 container>
	get the influxdb API token

Edit the telegraf config for influxdb
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "<token>
  organization = "$DOCKER_INFLUXDB_INIT_ORG"
  bucket = "$DOCKER_INFLUXDB_INIT_BUCKET"

Add sources to the telegraf config
[TBD]

Add influxdb token(s) to telegraf.conf
	Search for "REPLACE_ME" in the config, replace with influxdb token(s)
	
Run telegraf container
docker run -d --name telegraf \
	--restart unless-stopped \
	--net=container:influxdb2 \
	-v /docker/telegraf/telegraf.conf:/etc/telegraf/telegraf.conf:ro \
	-v /var/run/docker.sock:/var/run/docker.sock:ro \
	-v /:/hostfs:ro \
	-e HOST_ETC=/hostfs/etc \
	-e HOST_PROC=/hostfs/proc \
	-e HOST_SYS=/hostfs/sys \
	-e HOST_VAR=/hostfs/var \
	-e HOST_RUN=/hostfs/run \
	-e HOST_MOUNT_PREFIX=/hostfs \
	-e DOCKER_INFLUXDB_INIT_ORG=$INFLUX_ORG \
	-e DOCKER_INFLUXDB_INIT_BUCKET=$INFLUX_BUCKET \
	telegraf

# Copy starlark script for preprocessing AirNow data
# TODO: build a docker image with the starlark script?
sudo docker cp aq.star telegraf:/usr/local/bin
sudo docker exec telegraf chmod +x /usr/local/bin/aq.star

# Copy shell script to collect bucket size data
# TODO: build a docker image with the bucket script?
sudo docker cp inputs/influxdb2_bucket/bucket_k.sh telegraf:/usr/local/bin
sudo docker exec telegraf chmod +x /usr/local/bin/bucket_k.sh

Test the telegraf container
	sudo docker exec telegraf telegraf --test

Telegraf on Pi
  Get the Debian version
	cat /etc/os-release
	PRETTY_NAME="Raspbian GNU/Linux 10 (buster)"
  Add the repo key
	curl -sL https://repos.influxdata.com/influxdb.key | sudo apt-key add -
	OK
  Add the repo
	echo "deb https://repos.influxdata.com/debian buster stable" | sudo tee /etc/apt/sources.list.d/influxdb.list
	deb https://repos.influxdata.com/debian buster stable
  Install telegraf
	sudo apt-get update
	sudo apt-get install telegraf
  Start telegraf
	update /etc/telegraf/telegraf.conf, /etc/telegraf/telegrad.d/*
	sudo systemctl reload telegraf.service
  Add the telegraf user to video group, so it can run vcgencmd (to get GPU temp)
	sudo usermod -a -G video telegraf
  Test the command
	sudo -u telegraf vcgencmd measure_temp

